<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Documentation - Ray Framework</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Documentation";
    var mkdocs_page_input_path = "documentation.md";
    var mkdocs_page_url = "/documentation/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="./" class="icon icon-home"> Ray Framework</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Documentation</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#features">Features</a></li>
                
                    <li><a class="toctree-l4" href="#easy-apis">Easy APIs</a></li>
                
                    <li><a class="toctree-l4" href="#hooks">Hooks</a></li>
                
                    <li><a class="toctree-l4" href="#actions">Actions</a></li>
                
                    <li><a class="toctree-l4" href="#authentication">Authentication</a></li>
                
                    <li><a class="toctree-l4" href="#shields">Shields</a></li>
                
                    <li><a class="toctree-l4" href="#running-server">Running server</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../examples/">Examples</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting_started/">Getting started</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="./">Ray Framework</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="./">Docs</a> &raquo;</li>
    
      
    
    <li>Documentation</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="features">Features</h1>
<h2 id="easy-apis">Easy APIs</h2>
<p>Create a model and then decorated it with the endpoint decorator.</p>
<pre><code class="python">from ray.endpoint import endpoint
from ray_sqlalchemy import AlchemyModel
from sqlalchemy import Column, Integer, String

Base = declarative_base()

@endpoint('/user')
class UserModel(AlchemyModel):
    name = StringProperty()
    age = IntegerProperty()
</code></pre>

<p>Now, you have the http methods to interact with your model using the urls:</p>
<table>
<thead>
<tr>
<th>HTTP Verb</th>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/api/user</td>
<td>List all users</td>
</tr>
<tr>
<td>GET</td>
<td>/api/user/{id}</td>
<td>Get one user</td>
</tr>
<tr>
<td>POST</td>
<td>/api/user</td>
<td>Create an user</td>
</tr>
<tr>
<td>PUT</td>
<td>/api/user/{id}</td>
<td>Update an user</td>
</tr>
<tr>
<td>DELETE</td>
<td>/api/user/{id}</td>
<td>Delete an user</td>
</tr>
</tbody>
</table>
<h2 id="hooks">Hooks</h2>
<p>Hooks are really useful to add validations in different moments of your application. Hook is a class that connect with your model and will be executed <strong>before save the model, after the model be saved or before the model be deleted</strong>.</p>
<pre><code class="python">from ray.hooks import Hook

class AgeValidationHook(Hook):
    def before_save(self, user):
        if user.age &lt; 18:
            raise Exception('The user must have more than 18 years')
        return True

@endpoint('/user')
class UserModel(AlchemyModel):
    hooks = [AgeValidationHook]
    name = StringProperty()
    age = IntegerProperty()
</code></pre>

<table>
<thead>
<tr>
<th>Available Hooks</th>
</tr>
</thead>
<tbody>
<tr>
<td>before_delete</td>
</tr>
<tr>
<td>before_save</td>
</tr>
<tr>
<td>after_save</td>
</tr>
</tbody>
</table>
<p>Then, if you call the .put() method of UserModel and the user doesn't has age bigger than 18, an Exception will be raised.</p>
<h2 id="actions">Actions</h2>
<p>Actions provide a simple way to you create behavior in your models through your api. After writing the code bellow, you can use the url <strong>/api/user/user_id/activate</strong> to invoke the activate_user method.</p>
<pre><code class="python">from ray.actions import ActionAPI, action

class ActionUser(ActionAPI):
    __model__ = UserModel

    @action(&quot;/activate&quot;)
    def activate_user(self, model_id):
        user = storage.get(UserModel, model_id)
        user.activate = True
        storage.put(user)
</code></pre>

<h2 id="authentication">Authentication</h2>
<p>Ray has a built-in authentication module. To use it, you just need to inherit the Authentication class and implement the method <em>authenticate</em>. In this method, you'll check the data in the database and then return if the user can login or not. Remember that this method must return a dictionary if the authentication succeeded.</p>
<pre><code class="python">from ray.authentication import Authentication


class MyAuth(Authentication):

    @classmethod
    def authenticate(cls, username, password):
        user = User.query(User.username == username, User.password == password).one()
        return {'username': 'ray'} if user else None
</code></pre>

<p>If you want protect all the operations in this endpoint, you can just add this:</p>
<pre><code class="python">@endpoint('/person', authentication=MyAuth)
class PersonModel(ModelInterface):
    pass
</code></pre>

<p>After protect your endpoint via an Authentication, you will need to be loged in to don't get a 403 status code. To do this:</p>
<h4 id="login">Login</h4>
<pre><code class="python">import request
request.post('http://localhost:8080/api/_login',
             data={&quot;username&quot;: &quot;yourusername&quot;, &quot;password&quot;: &quot;yourpassword&quot;})
</code></pre>

<h4 id="logout">Logout</h4>
<pre><code class="python">import request
request.get('http://localhost:8080/api/_logout')
</code></pre>

<h2 id="shields">Shields</h2>
<p>Ray has an option to you protect just some HTTP methods of your endpoint: using Shields. How it works? You inherit from the Shield class and implement just the http method that you <em>want to protect</em>.</p>
<pre><code class="python">class PersonShield(Shield):
    __model__ = PersonModel

    def get(self, info):
        return info['profile'] == 'admin'

    # def put(self, info): pass

    # def post(self, info): pass

    # def delete(self, info): pass
</code></pre>

<p>This shield protects the GET method of /api/person. The parameter <em>info</em> in the get method on the shield, is the dictionary returned on your Authentication class. So, all Shields's methods receive this parameter. When you overwrite
a method, Ray will assume that method is under that Shield protection.</p>
<h3 id="shields-with-actions">Shields with Actions</h3>
<p>If you wanna to protect an action you can do this with Shield. To do this, you just need to implement a @classmethod method in your Shield, <em>that doesnt has one of these names: get, delete, post or put</em>.
If this Action is not used by an authenticated user, the parameter info in your Shiled's method will be None.</p>
<pre><code class="python">
class UserShield(Shield):
    __model__ = UserModel

    @classmethod
    def protect_enable(cls, info):
        return info['profile'] == 'admin'


class ActionUser(ActionAPI):
    __model__ = UserModel

    @action('/enable', protection=UserShield.protect_enable)
    def enable_user(self, model_id):
        user = session.get_user()
        user.enabled = True
        user.save()
</code></pre>

<h2 id="running-server">Running server</h2>
<p>Ray has a WSGI server to run your application. To use it, you just need to run the command bellow and start writing your business rules. The command parameter <em>--wsgifile</em>, must be used to tell to Ray in which file it should find your <em>application</em> scope.</p>
<pre><code class="python"># app.py file
from ray.wsgi.wsgi import application
</code></pre>

<pre><code class="bash">ray up --wsgifile=app.py
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../examples/" class="btn btn-neutral float-right" title="Examples">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="../examples/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
